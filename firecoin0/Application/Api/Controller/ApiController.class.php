<?php/** * Created by PhpStorm. * User: root * Date: 2018/11/2 * Time: 13:37 */namespace Api\Controller;use function PHPSTORM_META\elementType;use Think\Controller;use Home\Controller\HomeController;class ApiController extends HomeController{    //委托下单    public function order(){        $input = I('');        //待验证参数 $mandatory必选 $optional可选        $mandatory = ['accesskey','amount','currency','method','price','tradeType','sign','reqTime'];        $optional = ['acctType'];        $valid_res = SafeController::valid_sign($input,$mandatory,$optional);        if(!$valid_res['code']){            echo json($valid_res);die;        }else{            $res = ApiLogicController::upTrade($input,$valid_res['uid']);            if($res['code']){                $res['code'] = 1000;                $res['id'] = M('trade')->where(['userid'=>userid(),'market'=>$input['currency']])->order('id desc')->getField('id');                $res['message'] = $res['msg'];                unset($res['msg']);            }            echo json($res);        }    }    //取消委托    public function cancelOrder(){        $input = I('');        //待验证参数 $mandatory必选 $optional可选        $mandatory = ['accesskey','currency','id','method','sign','reqTime'];        $valid_res = SafeController::valid_sign($input,$mandatory);        if(!$valid_res['code']){            echo json($valid_res);die;        }else{            $res = ApiLogicController::chexiao($input['id']);            if($res['code']){                $res['code'] = 1000;                $res['message'] = $res['msg'];                unset($res['msg']);            }            echo json($res);        }    }    // 获取委托买单或卖单    public function getOrder(){        $input = I('');        //待验证参数 $mandatory必选 $optional可选        $mandatory = ['accesskey','currency','id','method','sign','reqTime'];        $valid_res = SafeController::valid_sign($input,$mandatory);        if(!$valid_res['code']){            echo json($valid_res);die;        }        $res = ApiLogicController::getOrder($input['id']);        if($res['code']) echo json($res['data']);        else echo json($res);    }    //获取多个委托买单或卖单，每次请求返回10条记录    public function getOrders(){        $input = I('');        //待验证参数 $mandatory必选 $optional可选        $mandatory = ['accesskey','currency','method','pageIndex','tradeType','sign','reqTime'];        $valid_res = SafeController::valid_sign($input,$mandatory);        if(!$valid_res['code']){            echo json($valid_res);die;        }        $res = ApiLogicController::getOrders($input);        if($res['code']) echo json($res['data']);        else echo json($res);    }    //(新)获取多个委托买单或卖单，每次请求返回pageSize<100条记录    public function getOrdersNew(){        $input = I('');        echo json(['code'=>101]);die;        //待验证参数 $mandatory必选 $optional可选        $mandatory = ['accesskey','currency','method','pageIndex','pageSize','tradeType','sign','reqTime'];        $valid_res = SafeController::valid_sign($input,$mandatory);        if(!$valid_res['code']){            echo json($valid_res);die;        }        $res = ApiLogicController::getOrdersNew($input);        if($res['code']) echo json($res['data']);        else echo json($res);    }    //与getOrdersNew的区别是取消tradeType字段过滤，可同时获取买单和卖单，每次请求返回pageSize10条记录    public function getOrdersIgnoreTradeType(){        $input = I('');        //待验证参数 $mandatory必选 $optional可选        $mandatory = ['accesskey','currency','method','pageIndex','pageSize','sign','reqTime'];        $valid_res = SafeController::valid_sign($input,$mandatory);        if(!$valid_res['code']){            echo json($valid_res);die;        }        $res = ApiLogicController::getOrdersIgnoreTradeType($input);        if($res['code']) echo json($res['data']);        else echo json($res);    }    //获取未成交或部份成交的买单和卖单，每次请求返回pageSize<=10条记录    public function getUnfinishedOrdersIgnoreTradeType(){        $input = I('');        //待验证参数 $mandatory必选 $optional可选        $mandatory = ['accesskey','currency','method','pageIndex','pageSize','sign','reqTime'];        $valid_res = SafeController::valid_sign($input,$mandatory);        if(!$valid_res['code']){            echo json($valid_res);die;        }        $res = ApiLogicController::getUnfinishedOrdersIgnoreTradeType($input);        if(isset($res['code']) && $res['code']) echo json($res['data']);        else echo json($res);    }    //获取用户信息    public function getAccountInfo(){        $input = I('');//        待验证参数 $mandatory必选 $optional可选        $mandatory = ['accesskey','method','sign','reqTime'];        $valid_res = SafeController::valid_sign($input,$mandatory);        if(!$valid_res['code']){            echo json($valid_res);die;        }        $res = ApiLogicController::getAccountInfo();        echo json($res['data']);    }    //获取用户充值地址    public function getUserAddress(){        $input = I('');        //待验证参数 $mandatory必选 $optional可选        $mandatory = ['accesskey','method','currency','sign','reqTime'];        $valid_res = SafeController::valid_sign($input,$mandatory);        if(!$valid_res['code']){            echo json($valid_res);die;        }        $res = ApiLogicController::getUserAddress($input);        echo json($res);    }    //获取用户认证的提现地址    public function getWithdrawAddress(){        $input = I('');        //待验证参数 $mandatory必选 $optional可选        $mandatory = ['accesskey','method','currency','sign','reqTime'];        $valid_res = SafeController::valid_sign($input,$mandatory);        if(!$valid_res['code']){            echo json($valid_res);die;        }        $res = ApiLogicController::getWithdrawAddress($input);        echo json($res);    }    // 获取数字资产提现记录    public function getWithdrawRecord(){        $input = I('');        //待验证参数 $mandatory必选 $optional可选        $mandatory = ['accesskey','method','currency','pageIndex','pageSize','sign','reqTime'];        $valid_res = SafeController::valid_sign($input,$mandatory);        if(!$valid_res['code']){            echo json($valid_res);die;        }        $res = ApiLogicController::getWithdrawRecord($input);        echo json($res);    }    //获取数字资产充值记录    public function getChargeRecord(){        $input = I('');        //待验证参数 $mandatory必选 $optional可选        $mandatory = ['accesskey','method','currency','pageIndex','pageSize','sign','reqTime'];        $valid_res = SafeController::valid_sign($input,$mandatory);        if(!$valid_res['code']){            echo json($valid_res);die;        }        $res = ApiLogicController::getChargeRecord($input);        echo json($res);    }    //提现    public function withdraw(){        $input = I('');        //待验证参数 $mandatory必选 $optional可选        $mandatory = ['accesskey','method','amount','currency','fees','itransfer','receiveAddr','safePwd','sign','reqTime'];        $optional = ['wcg_key'];        $valid_res = SafeController::valid_sign($input,$mandatory,$optional);        if(!$valid_res['code']){            echo json($valid_res);die;        }        $res = ApiLogicController::withdraw($input);        if($res['code']){            $id = M('myzc')->where(['userid'=>userid(),'coinname'=>$input['currency']])->order('id desc')->getField('id');            echo json(['1000'=>1000,'message'=>'success','id'=>$id]);        } else{            echo json($res);        }    }}