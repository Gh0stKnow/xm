{include file="trade:header"/}

<div class="autobox mt20 clear" id="Kline-change" style="padding-top: 20px;">
    <div class="left w790" style="position: relative;">
        <!--行情图-->
        <div id="kline">
            <div id="paint_chart" style="height: 400px">
                <iframe style="border-style: none;" border="0" width="100%" height="400" id="market_chart" src="/Trade/ordinary?market={$market}"></iframe>
            </div>
        </div>

        <!--行情图结束-->
		<style>
            .trade_note {
                margin: 0 auto 10px auto;
                padding: 17px 10px;
                background: rgba(49, 166, 222, 0.08);
                overflow: hidden;
                font-size: 12px;
            }
            .trade_note .text {
                float: left;
                font-size: 12px;
                color: #106f9c;
                /* background: url(__PUBLIC__/home/images/note.png) left center no-repeat; */
                padding-left: 20px;
                line-height: 25px;
            }
		
		</style>

        {if condition='1 eq 0'}
		<!--<div class="trade_note">-->
        	<!--<div class="text">风险提示：数字货币投资存在一定的风险，请适量控制您的资金，不要投资您所不了解的数字货币，拒绝传销组织，警惕虚假宣传。</div>-->
        <!--</div>-->
		<!---->
		<!--<div class="trade_note">-->
			<!--&lt;!&ndash;<div class="text">&ndash;&gt;-->
				<!--&lt;!&ndash;<span class="icon"></span> &ndash;&gt;-->
				<!--&lt;!&ndash;<span class="hinttext"> &ndash;&gt;-->
					<!--&lt;!&ndash;<span class="define">重要提示：</span>&ndash;&gt;-->
					<!--&lt;!&ndash;今日涨停价格：<span class="red" id="zhangting"></span>, &ndash;&gt;-->
					<!--&lt;!&ndash;今日跌停价格：<span class="red" id="dieting"></span>&ndash;&gt;-->
					<!--&lt;!&ndash;&ndash;&gt;-->
					<!--&lt;!&ndash;&nbsp;&nbsp;&nbsp;&nbsp 交易时间：{$market_time}&ndash;&gt;-->
				<!--&lt;!&ndash;</span>&ndash;&gt;-->
			<!--&lt;!&ndash;</div>&ndash;&gt;-->
            <!--<div class="text">风险提示：数字货币投资存在一定的风险，请适量控制您的资金，不要投资您所不了解的数字货币，拒绝传销组织，警惕虚假宣传。</div>-->
			<!--<div id="coins_timer" style="float: right; font-size: 14px; text-align: right; color: #f60;" ></div>-->
		<!--</div>-->
        {/if}
		
        <div class="fast_tr clear">

            <a name="mark-trade"></a>
            <form method="post" class="ft_box" id="form-buy">
                <dl>
                    <dt class="orange">{:lang('BUY')}</dt>
                    <dd>
                        <p>{:lang('BUY1_BEST')}：</p>
                        <span class="orange" id="buy_best_price" onclick="setMaiRu();" style="cursor:pointer;">
                            {eq name="buy_best_price.price" value=""}
                               -
                                {else/}
                                {$buy_best_price['price']}
                            {/eq}
                        </span> {$rmb|strtoupper}/{$xnb|strtoupper}

                        {eq name="C['trade_hangqing']" value="1"}
                            <a style="float: right;margin-right: 60px;color:#e55600;" id="market_hangqing" onclick="hangqing()">{:lang('QUOTATION')}</a>
                        {/eq}
                    </dd>
                    <dd>
                        <p>{:lang('BUY_PRICE')}：</p>
                        <input type="text" id="buy_price" name="price" placeholder="{:lang('PER_COIN')}" value="" maxlength="8"/>
                    </dd>
                    <dd id="buy_chage" style="display: none;">
                        <p  style="width: 210px;color: #0a6ec8;margin-left: -71px;">涨停价格：<span id="buy_zhang" style="color: #b10000"></span> 跌停价格：<span id="buy_die" style="color: #b10000"></span></p>
                    </dd>
                    <dd>
                        <p>{:lang('MAX_BUY')}：</p>
                        <span class="col_333" id="buy_max" title="{:lang('FULL_IN_TIP')}">-</span> {$xnb|strtoupper}
                    </dd>
                    <dd>
                        <p>{:lang('BUY_PROPORTION')}：</p>
                        <div class="slider_wrap">
                            <div id="ratio_num_buy" class="ratio">0%</div>
                            <div class="sliderbox">
                                <div id="slider_buy"
                                     class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all">
                                    <div class="ui-slider-range ui-widget-header ui-slider-range-min"></div>
                                    <a data_slide="buy" class="ui-slider-handle ui-state-default ui-corner-all" href="#"
                                       style="left: 0%;"></a>
                                    <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min"
                                         style="width: 0%;"></div>
                                </div>
                            </div>
                        </div>
                    </dd>
                    <dd>
                        <p>{:lang('BUY_QUANTITY')}：</p>
                        <input type="text" id="buy_num" name="num" maxlength="8"/>
                    </dd>
                    <dd>
                        <p>{:lang('TOTAL')}：</p>
                        <span class="col_333" id="buy_mum">-</span> {$rmb|strtoupper}
                    </dd>
                    <dd>
                        <p>{:lang('TRANSACTION_FEE')}：</p>
                        {:config('market')[$market]['fee_buy']}%
                    </dd>
                    <dd class="pwdtrade" style="margin-top: 17px;">
                        <p style="    line-height: 20px;text-indent: 3em;">{:lang('TRAN_PWD')}：</p>
                        <input id="buy_paypassword" name="pwtrade" type="password" autocomplete="off"> <span onclick="layertpwd()"
                                                                                          class="settings"></span>
                    </dd>

					{eq name="showPW" value="0"}
						<dd style="color:#ff0000;line-height: 20px;">
                            {:lang('TRAN_PWD_SET_NO')}
						</dd>
					{/eq}
					
					{eq name="showPW" value="2"}
						<dd style="color:#ff0000;line-height: 20px;">
                            {:lang('TRAN_PWD_NO')}
						</dd>
					{/eq}

                </dl>
                <div>
                    <div class="trader_btn">
                        <div class="tan_btn" id="tm-buy"></div>
                        <input type="button" value="{:lang('BUY')}" onclick="tradeadd_buy();">
                    </div>
                </div>
            </form>
            <form method="post" class="ft_box nobr" id="form-sell">
                <dl>
                    <dt class="green">{:lang('SELL')}</dt>
                    <dd>
                        <p>{:lang('SELL1_BEST')}：</p>
                        <span class="orange" id="sell_best_price"  onclick="setMaiChu();"  style="color: #690!important;cursor:pointer;">
                            {eq name="sell_best_price.price" value=""}
                               -
                                {else/}
                                {$sell_best_price['price']}
                            {/eq}
                        </span>
                        {$rmb|strtoupper}/{$xnb|strtoupper}

                        {eq name="C['trade_hangqing']" value="1"}
                            <a style="float: right;margin-right: 60px;color:#e55600;" id="market_hangqing"  onclick="hangqing()">{:lang('QUOTATION')}</a>
                        {/eq}
                    </dd>
                    <dd>
                        <p>{:lang('SELL_PRICE')}：</p>
                        <input type="text" id="sell_price" name="price" placeholder="{:lang('PER_COIN')}" maxlength="8"/>
                    </dd>
                    <dd id="sell_chage" style="display: none;">
                        <p  style="width: 210px;color: #0a6ec8;margin-left: -71px;">涨停价格：<span id="sell_zhang" style="color: #b10000"></span> 跌停价格：<span id="sell_die" style="color: #b10000"></span></p>
                    </dd>
                    <dd>
                        <p>{:lang('MAX_SELL')}：</p>
                        <span id="sell_max" class="col_333">-</span> {$xnb|strtoupper}
                    </dd>
                    <dd>
                        <p>{:lang('SELL_PROPORTION')}：</p>
                        <div class="slider_wrap">
                            <div id="ratio_num_sell" class="ratio">0%</div>
                            <div class="sliderbox">
                                <div id="slider_sell"
                                     class="ui-slider ui-slider-horizontal ui-widget ui-widget-content ui-corner-all">
                                    <div class="ui-slider-range ui-widget-header ui-slider-range-min"></div>
                                    <a data_slide="sell" class="ui-slider-handle ui-state-default ui-corner-all"
                                       href="#" style="left: 0%;"></a>
                                    <div class="ui-slider-range ui-widget-header ui-corner-all ui-slider-range-min"
                                         style="width: 0%;"></div>
                                </div>
                            </div>
                        </div>
                    </dd>
                    <dd>
                        <p>{:lang('SELL_QUANTITY')}：</p>
                        <input type="text" id="sell_num" name="num" maxlength="8"/>
                    </dd>
                    <dd>
                        <p>{:lang('TOTAL')}：</p>
                        <span class="col_333" id="sell_mum">-</span> {$rmb|strtoupper}
                    </dd>
                    <dd>
                        <p>{:lang('TRANSACTION_FEE')}：</p>
                        {:config('market')[$market]['fee_sell']}%
                    </dd>
					
					
                    <dd class="pwdtrade" style="margin-top: 17px;">
                        <p style="    line-height: 20px;text-indent: 3em;">{:lang('TRAN_PWD')}：</p>
                        <input id="sell_paypassword" name="pwtrade" type="password" autocomplete="off"> <span onclick="layertpwd()"
                                                                                           class="settings"></span>
                    </dd>
					
					{eq name="showPW" value="0"}
						<dd style="color:#ff0000;line-height: 20px;">
                            {:lang('TRAN_PWD_SET_NO')}
							
						</dd>
					{/eq}
					
					{eq name="showPW" value="2"}
						<dd style="color:#ff0000;line-height: 20px;">
                            {:lang('TRAN_PWD_NO')}
						</dd>
					{/eq}

                </dl>
                <div>
                    <div class="trader_btn">
                        <div class="tan_btn" id="tm-sell"></div>
                        <input class="bg_green" type="button" value="{:lang('SELL')}" onclick="tradeadd_sell();">
                    </div>
                </div>
            </form>
        </div>
    </div>
    <div class="right w390">
        <div class="zcxx hide" style="display: block; margin-bottom: 20px;">
            <div class="right_table">
                <table style="width: 100%">
                    <tbody>
                    <tr>
                        <th>{:lang('AVAILABLE')}{$C['coin'][$xnb]['title']}</th>
                        <td><span id="my_xnb">0</span></td>
                    </tr>
                    <tr>
                        <th>{:lang('FROZEN')}{$C['coin'][$xnb]['title']}</th>
                        <td><font id="my_xnbd">0</font></td>
                    </tr>
                    <tr>
                        <th>{:lang('AVAILABLE')}{$C['coin'][$rmb]['title']}</th>
                        <td><span id="my_rmb">0</span></td>
                    </tr>
                    <tr>
                        <th>{:lang('FROZEN')}{$C['coin'][$rmb]['title']}</th>
                        <td><font id="my_rmbd">0</font></td>
                    </tr>
                    <!--<tr>-->
                        <!--<th>账户总资产</th>-->
                        <!--<td><font id="user_finance">0</font></td>-->
                    <!--</tr>-->
                    </tbody>
                </table>
            </div>
        </div>
        <div class="tradeBox">
            <div class="slideHd">
                <!-- 下面是前/后按钮代码，如果不需要删除即可 -->
                <ul class="active">
                    <li id="trade_moshi_1" class="trade_moshi on"><a href="javascript:void(0);" onclick="moshi(1)">{:lang('DEFAULT')} </a></li>
                    {eq name="C['trade_moshi']" value="1"}
                        <li style="display:none;" id="trade_moshi_2" class="trade_moshi"><a href="javascript:void(0);" onclick="moshi(2)">聊天模式 </a></li>
                    {/eq}
                    <li id="trade_moshi_3" class="trade_moshi"><a href="javascript:void(0);" onclick="moshi(3)">{:lang('ONLY_BUY')} </a></li>
                    <li id="trade_moshi_4" class="trade_moshi"><a href="javascript:void(0);" onclick="moshi(4)">{:lang('ONLY_SELL')} </a></li>
                </ul>
            </div>
        </div>

        <div class="entrust" style="max-height: 830px;" id="trade_moshi_liaotian_2">
            <div class="entrust_list">
                <ul>
                    <li class="first" style="width: 56px;">{:lang('BUY')}/{:lang('SELL')}</li>
                    <li class="w85" style="width: 90px">{:lang('PRICE')}</li>
                    <li class="w64" style="width: 120px">{:lang('QUANTITY')}</li>
                    <li class="w62" style="width: 100px">{:lang('AMOUNT')}</li>
                </ul>
                <div class="el_dl" id="selllist"></div>
                <!--<div  class="el_dl" id="autosell"></div>-->
                <!--<div class="el_dl" id="autobuy"></div>-->
                <div class="el_dl" id="buylist" style="border-bottom: 1px dotted #fff;"></div>
            </div>
        </div>
    </div>
</div>
<div class="clear over_auto  account_table autobox mt20" style="margin-top: 20px;">
    <div id="entrust_over" class=" over_auto" style="margin-bottom: 10px;">
        <div class="TitleBox" style="border_top: 1px solid #D5D5D5;">
            <h3 class="PlateTitle">{:lang('COMMISSION')}</h3>
        </div>
        <div class="over_auto">
            <table class="Transaction no_border_right no_border_left_right">
                <thead>
                <tr>
                    <th width="180">{:lang('TIME')}</th>
                    <th width="80">{:lang('BUY')}/{:lang('SELL')}</th>
                    <th>{:lang('PRICE')}</th>
                    <th>{:lang('QUANTITY')}</th>
                    <th>{:lang('FINISHED')}</th>
                    <th>{:lang('AMOUNT')}</th>
                    <th width="80">{:lang('OPERATE')}</th>
                </tr>
                </thead>
                <tbody id="entrustlist" class="no-border-left-right">
                </tbody>
            </table>
        </div>
    </div>
</div>
<div class=" autobox " style="border_bottom: 1px solid #D5D5D5; margin-top: 20px;">
    <div class="clear">
        <div class="TitleBox" style="border_top: 1px solid #D5D5D5;">
            <h3 class="PlateTitle">{:lang('LATEST_TRAN_RECORD')}</h3>
        </div>
        <div class=" over_hidden">
            <div class="over_auto">
                <table class="Transaction  no_border_right no_border_left_right">
                    <thead>
                    <tr>
                        <th width="180">{:lang('TIME')}</th>
                        <th width="80">{:lang('BUY')}/{:lang('SELL')}</th>
                        <th width="250">{:lang('FINISH_PRICE')}</th>
                        <th width="250">{:lang('FINISH_QUANTITY')}</th>
                        <th><span style="padding_right: 18px;">{:lang('TOTAL_AMOUNT')}</span></th>
                    </tr>
                    </thead>
                </table>
            </div>
            <div class="over_auto" style="_height: 508px; max-height: 508px; overflow-x: hidden; overflow-y: auto;">
                <table class="Transaction  no_border_right no_border_left_right">
                    <!--<tbody id="auto_order" class="no-border-left-right">-->
                    <!--</tbody>-->
                    <tbody id="orderlist" class="no-border-left-right">
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
<br>
<br>

<script type="text/javascript">
    var market = "{$market}";
    var market_round = "{$C['market'][$market]['round']}";
    var market_round_num = 8 - "{$C['market'][$market]['round']}";
    var userid = "{$Think.session.userId}";
    var trade_moshi = 1;
    var getDepth_tlme = null;
    var lock_market_buy = 0;
    var lock_market_sell = 0;
    var lock_market_chexiao = 0;
    var zhang = "{$C['market'][$market]['zhang']}";
    var die  = "{$C['market'][$market]['die']}";
    var houprice = "{$C['market'][$market]['hou_price']}";
	var time = 5;
	var isInterval = setInterval(function () {
		$('#coins_timer').html(time + '{:lang(\'SECONDS_LATER_REFRESH\')}');
		time--;
		if (time == -1) {
			//clearInterval(isInterval);
			time=5;
		}
	}, 1000);


    // $('#buy_price').blur(function () {
	 //    if (market == 'drt_hkd'){
    //         var price = $('#buy_price').val();
    //         var zhangt = ((houprice * zhang)/100 + parseFloat(houprice)).toFixed(3);
    //         var diet  =  (houprice - (houprice * die)/100).toFixed(3);
    //         if (price >= zhangt || price <= diet) {
    //             $('#buy_chage').show();
    //             $('#buy_zhang').html(zhangt);
    //             $('#buy_die').html(diet);
    //         }
    //     }
    //
    // })
    // $('#sell_price').blur(function () {
    //     if (market == 'drt_hkd') {
    //         var price = $('#sell_price').val();
    //         var zhangt = ((houprice * zhang)/100 + parseFloat(houprice)).toFixed(3);
    //         var diet  =  (houprice - (houprice * die)/100).toFixed(3);
    //         if (price >= zhangt || price <= diet) {
    //             $('#sell_chage').show();
    //             $('#sell_zhang').html(zhangt);
    //             $('#sell_die').html(diet);
    //         }
    //     }
    //
    // })
    function hangqing() {
        layer.alert("{:lang('TRAN_MARKET')}:{:config('market')[$market]['title']}<br><br>" +
                "{:lang('YESTODAY_CLOSING')}:{$C['market'][$market]['hou_price']|NumToStr}<br>" +
                "{:lang('TODAY_LIMIT_INCREASE')}：{:config('market')[$market]['zhang']}%<br>" +
                "{:lang('TODAY_LIMIT_DECLINE')}：{:config('market')[$market]['die']}%<br>" +
                "{:lang('TODAY_MIN_PRICE')}:{$C['market'][$market]['buy_min']|NumToStr}<br>" +
                "{:lang('TODAY_MAX_PRICE')}:{$C['market'][$market]['sell_max']|NumToStr}<br>",
                {title: '{:lang(\'QUOTATION\')}',});
    }

    function moshi(id) {
        trade_moshi = id;
        $('.trade_moshi').removeClass('on');
        $('#trade_moshi_' + id).addClass('on');
        if (id == 3) {
            $('#selllist').hide();
            $('#autosell').hide();
        } else {
            $('#selllist').show();
            $('#autosell').show();
        }

        if (id == 4) {
            $('#buylist').hide();
            $('#autobuy').hide();
        } else {
            $('#buylist').show();
            $('#autobuy').show();
        }

        if (id == 2) {
            //$('#trade_moshi_liaotian_2').hide();
            //$('#trade_moshi_liaotian_1').show();
            if("WebSocket" in window && '{$Think.APP_SOCKET}' != 0){
                window.setTimeout(function(){
                    var send_obj = {c:'TradeController',m:'both',u:'test',d:{market:market}};
                    window.ws.send(get_encryption_param(send_obj));
                },3000);

            }else{
                getDepth();
            }
        } else {
            $('#trade_moshi_liaotian_2').show();
            //$('#trade_moshi_liaotian_1').hide();
            if("WebSocket" in window && '{$Think.APP_SOCKET}' != 0){
                window.setTimeout(function(){
                    var send_obj = {c:'TradeController',m:'both',u:'test',d:{market:market}};
                    window.ws.send(get_encryption_param(send_obj));
                },3000);
            }else{
                getDepth();
            }
        }
    }

    function layertpwd() {
        var html = '<div id="all_mask" class="all_mask"></div><div id="tpwd" class="all_mask_loginbox">' +
                '<div class="login_title pl20">{:lang(\'TRAN_PWD_SET\')}</div><form method="post" id="tpwdsetting" class="set_verify">' +
                '<ul class="tpwd"><li><label for="only"><input type="radio" id="only" value="1" name="aaatpwdsetting"> {:lang(\'TRAN_PWD_ONCE\')} </label></li><li>' +
                '<label for="every"><input type="radio" checked id="every" value="2" name="aaatpwdsetting"> {:lang(\'TRAN_PWD_EVERY\')}</label></li><li><label for="none">' +
                '<input type="radio" id="none" name="aaatpwdsetting" value="3"> {:lang(\'TRAN_PWD_NONE\')}</label></li><li><input type="password" autocomplete="off" id="aaapaypassword" name="paypassword" placeholder="{:lang(\'TRAN_PWD_ENTER\')}" class="text"/>' +
                '</li></ul><div class="save_verify"><input type="button" value="{:lang(\'KEEP\')}" onclick="tpwdsettingaa()" /></div><div class="mask_wrap_close" id="pwd_close"></div></form></div>';
        $('body').append(html);
        $('#tpwd').css('top', ($(window).height() / 2) - (265 / 2) + $(document).scrollTop());
        $('.all_mask').css({'height': $(document).height()});
        $('#pwd_close').click(function () {
            $('#tpwd').remove();
            $('#all_mask').remove();
        })

        $.post('/user/tpwdsetting', function (d) {
            if (d == 1) {
                $('#only').prop('checked', true);
            }
            if (d == 2) {
                $('#every').prop('checked', true);
            }
            if (d == 3) {
                $('#none').prop('checked', true);
            }
        })
    }

    //保存交易密码设置
    function tpwdsettingaa() {
        var paypassword = $("#aaapaypassword").val();
        var tpwdsetting = $("input[name='aaatpwdsetting']:checked").val();
        if (paypassword == "" || paypassword == null) {
            layer.tips('{:lang(\'TRAN_PWD_ENTER\')}', '#paypassword', {tips: 3});
            return false;
        }
        if (tpwdsetting == "" || tpwdsetting == null) {
            layer.tips('{:lang(\'SELECT_ONE\')}', '#tpwdsetting', {tips: 3});
            return false;
        }


        $.post('/user/uptpwdsetting', {paypassword: paypassword, tpwdsetting: tpwdsetting}, function (d) {
            if (d.code) {
                layer.msg('{:lang(\'SET_SUCCESSFUL\')}', {icon: 1});
                window.location.reload();
            } else {
                layer.msg(d.info, {icon: 2});
            }

        }, 'json');
    }

    //买单
    function tradeadd_buy() {
        if (lock_market_buy) {
            layer.msg('{:lang(\'NOT_SUBMIT_MORE\')}', {icon: 2});
            return;
        }
        lock_market_buy = 1;

        var price = parseFloat($('#buy_price').val());
        var num = parseFloat($('#buy-num').val());
        var paypassword = $('#buy_paypassword').val();
        if (price == "" || price == null) {
            layer.tips('{:lang(\'ENTER_CONTENT\')}', '#buy_price', {tips: 3});
            return false;
        }
        if (num == "" || num == null) {
            layer.tips('{:lang(\'ENTER_CONTENT\')}', '#buy_num', {tips: 3});
            return false;
        }

        //加载层-风格3
        layer.load(2);

        //此处演示关闭
        setTimeout(function () {
            layer.closeAll('loading');
            lock_market_buy = 0;
        }, 10000);
        var tokenStr = get_token();
        //超过 20% 提示文本框
        if ($('#buy_price').val() > $("#market_sell_price").html() * 1.05) {
            layer.confirm('您输入的买入价与当前市场最新价有较大出入，是否确认交易？', {
                btn: ['确定本次交易','取消本次交易'] //按钮
            }, function(){
                $.post("{:url('Trade/upTrade',['reqstamp'=>'req_stamp'])}".replace("req_stamp",new Date().getTime()), {
                    price: $('#buy_price').val(),
                    num: $('#buy_num').val(),
                    paypassword: $('#buy_paypassword').val(),
                    market: market,
                    type: 1,
                    token_str:tokenStr
                }, function (data) {
                    layer.closeAll('loading');
                    lock_market_buy = 0;
                    if (data.code == 1) {

                        $("#buy_price").val('');
                        $("#buy_num").val('');
                        $("#sell_price").val('');
                        $("#sell_num").val('');
                        $('#buy_paypassword').val('');
                        layer.msg(data.msg, {icon: 1});
                    } else {
                        layer.msg(data.msg, {icon: 2});
                    }
                }, 'json');
            }, function(){
                layer.closeAll('loading');
                lock_market_buy = 0;
                layer.msg('已取消本次操作', {
                    time: 3000, //3s后自动关闭
                });
            });
        } else {
            $.post("{:url('Trade/upTrade',['reqstamp'=>'req_stamp'])}".replace("req_stamp",new Date().getTime()), {
                price: $('#buy_price').val(),
                num: $('#buy_num').val(),
                paypassword: $('#buy_paypassword').val(),
                market: market,
                type: 1,
                token_str:tokenStr
            }, function (data) {
                layer.closeAll('loading');
                lock_market_buy = 0;
                if (data.code == 1) {

                    $("#buy_price").val('');
                    $("#buy_num").val('');
                    $("#sell_price").val('');
                    $("#sell_num").val('');
                    $('#buy_paypassword').val('');
                    layer.msg(data.msg, {icon: 1});
                } else {
                    layer.msg(data.msg, {icon: 2});
                }
            }, 'json');
        }
    }

    //卖单
    function tradeadd_sell() {
        if (lock_market_sell) {
            layer.msg('{:lang(\'NOT_SUBMIT_MORE\')}', {icon: 2});
            return;
        }
        lock_market_sell = 1;
        var price = parseFloat($('#sell_price').val());
        var num = parseFloat($('#sell_num').val());
        var paypassword = $('#sell_paypassword').val();
        if (price == "" || price == null) {
            layer.tips('{:lang(\'ENTER_CONTENT\')}', '#sell_price', {tips: 3});
            return false;
        }
        if (num == "" || num == null) {
            layer.tips('{:lang(\'ENTER_CONTENT\')}', '#sell_num', {tips: 3});
            return false;
        }
        layer.load(2);
        //此处演示关闭
        setTimeout(function () {
            layer.closeAll('loading');
            lock_market_sell = 0;
        }, 10000);
        var tokenStr = get_token();

        //超过 20% 提示文本框
        if ($('#sell_price').val() < $("#market_buy_price").html() * 0.95) {
            layer.confirm('您输入的卖出价与当前市场最新价有较大出入，是否确认交易？', {
                btn: ['确定本次交易','取消本次交易'] //按钮
            }, function(){
                $.post("{:url('Trade/upTrade',['reqstamp'=>'req_stamp'])}".replace("req_stamp",new Date().getTime()), {
                    price: $('#sell_price').val(),
                    num: $('#sell_num').val(),
                    paypassword: $('#sell_paypassword').val(),
                    market: market,
                    type: 2,
                    token_str:tokenStr
                }, function (data) {
                    layer.closeAll('loading');
                    lock_market_sell = 0;
                    if (data.code == 1) {
                        $("#buy_price").val('');
                        $("#buy_num").val('');
                        $("#sell_price").val('');
                        $("#sell_num").val('');
                        $('#sell_paypassword').val('');
                        layer.msg(data.msg, {icon: 1});
                    } else {
                        layer.msg(data.msg, {icon: 2});
                    }
                }, 'json');
            }, function(){
                layer.closeAll('loading');
                lock_market_sell = 0;
                layer.msg('已取消本次操作', {
                    time: 3000, //3s后自动关闭
                });
            });
        } else {
            $.post("{:url('Trade/upTrade',['reqstamp'=>'req_stamp'])}".replace("req_stamp",new Date().getTime()), {
                price: $('#sell_price').val(),
                num: $('#sell_num').val(),
                paypassword: $('#sell_paypassword').val(),
                market: market,
                type: 2,
                token_str:tokenStr
            }, function (data) {
                layer.closeAll('loading');
                lock_market_sell = 0;
                if (data.code == 1) {
                    $("#buy_price").val('');
                    $("#buy_num").val('');
                    $("#sell_price").val('');
                    $("#sell_num").val('');
                    $('#sell_paypassword').val('');
                    layer.msg(data.msg, {icon: 1});
                } else {
                    layer.msg(data.msg, {icon: 2});
                }
            }, 'json');
        }
    }

    //撤销
    function cancelaa(id) {
        if (lock_market_chexiao) {
            layer.msg('{:lang(\'NOT_SUBMIT_MORE\')}', {icon: 2});
            return;
        }
        lock_market_chexiao = 1;
        $.post("{:url('Trade/chexiao',['reqstamp'=>'req_stamp'])}".replace("req_stamp",new Date().getTime()), {id: id}, function (data) {
            lock_market_chexiao = 0;
            if (data.code == 1) {
                getEntrustAndUsercoin();
                layer.msg(data.msg, {icon: 1});
            } else {
                layer.msg(data.msg, {icon: 2});
            }
        });
    }

    //RSA encrypt
    function get_encryption_param(obj){
        var encrypt = new JSEncrypt();
        encrypt.setPublicKey("-----BEGIN PUBLIC KEY-----\n" +
            "MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDAWtC5qZH9kxXVnA0Hgu5U1Mzy\n" +
            "7cDSvV2+fBW/Df33GH3ZYhapw0Vq9x2mcY9J4ObWNX0fXJJfppci1LMvNOt1lPrJ\n" +
            "LfIVfoJSKTykcFmwZxW2yEAjwL8M5JiiNCtiaA9+qoWkU1Xrhk92MdfsbdsOajbd\n" +
            "L7HViwvGnk4N1qD8VQIDAQAB\n" +
            "-----END PUBLIC KEY-----");
        var encrypted = encrypt.encrypt(JSON.stringify(obj));
        param = new Object();
        param.encrypted =  encrypted;
        param.token = $.md5(encrypted);
        return JSON.stringify(param);
    }

    //Trade Order
    function getsort(arr, sorted){
        var a = new Array();
        $(arr).each(function(ix,vx){
            a.push(JSON.parse(vx));
        });
        if(sorted == 'asc'){
            a.sort(function(one,two){
                return one.price - two.price;
            });
        }else if(soted = 'desc'){
            a.sort(function(one,two){
                return two.price - one.price;
            });
        }
        return a;
    }

    //Websocket Tradelog
    function getTradelogSocket(received_msg) {
        data = received_msg.getTradelog;
        var list ='';
        for (var i in data) {
            var d = JSON.parse(data[i]);
            if (d.type == 1) {
                list +='<tr title="{:lang(\'SOLD_AT_PRICE\')}" onclick="autotrust(this,\'buy\',2)"><td class="buy"   width="180">' + d.addtime + '</td><td class="buy"   width="80">{:lang(\'BUY\')}</td><td class="buy"   width="250">' + d.price + '</td><td class="buy"  width="250">' + d.num + '</td><td class="buy">' + d.mum + '</td></tr>';
            } else {
                list += '<tr title="{:lang(\'BUY_AT_PRICE\')}" onclick="autotrust(this,\'sell\',2)"><td class="sell"   width="180">' + d.addtime + '</td><td class="sell"   width="80">{:lang(\'SELL\')}</td><td class="sell"   width="250">' + d.price + '</td><td class="sell"  width="250">' + d.num + '</td><td class="sell">' + d.mum + '</td></tr>';
            }
        }
        $("#orderlist").html(list);
        setTimeout(function(){
            var send_obj = {c:'TradeController',m:'both',u:'test',d:{market:market}};
            window.ws.send(get_encryption_param(send_obj));
        },3000);
    }

    //Websocket Depth
    function getDepthSocket(received_msg) {
        if(trade_moshi != 2){
            if(received_msg.buy){
                var list ='';
                received_msg.buy = getsort(received_msg.buy,'desc');
                if(trade_moshi == 1){
                    if(received_msg.buy.length <= 15){
                        for(var i = 0 ;i<received_msg.buy.length;i++){
                            var buy_obj = received_msg.buy[i];
                            list += '<dl title="{:lang(\'SOLD_AT_PRICE\')}" style="cursor: pointer;" onclick="autotrust(this,\'buy\',1)"><dt class="buy"  style="width: 40px;padding-left: 5px;">{:lang(\'BUY\')}' + (i + 1) + '</dt><dd class="buy"  style="width: 90px">' + parseFloat(buy_obj.price) + '</dd><dd class="buy"  style="width: 100px">' + parseFloat(buy_obj.nums) + '</dd><dd class="buy"  style="width: 120px;padding-left: 3px;">' + (buy_obj.price * buy_obj.nums).toFixed(6) + '</dd></dl>';
                        }
                    }else{
                        for(var i = 0 ;i < 15;i++){
                            var buy_obj = received_msg.buy[i];
                            list += '<dl title="{:lang(\'SOLD_AT_PRICE\')}" style="cursor: pointer;" onclick="autotrust(this,\'buy\',1)"><dt class="buy"  style="width: 40px;padding-left: 5px;">{:lang(\'BUY\')}' + (i + 1) + '</dt><dd class="buy"  style="width: 90px">' + parseFloat(buy_obj.price) + '</dd><dd class="buy"  style="width: 100px">' + parseFloat(buy_obj.nums) + '</dd><dd class="buy"  style="width: 120px;padding-left: 3px;">' + (buy_obj.price * buy_obj.nums).toFixed(6) + '</dd></dl>';
                        }
                    }
                }else if(trade_moshi == 3){
                    for(var i = 0 ;i<received_msg.buy.length;i++){
                        var buy_obj = received_msg.buy[i];
                        list += '<dl title="{:lang(\'SOLD_AT_PRICE\')}" style="cursor: pointer;" onclick="autotrust(this,\'buy\',1)"><dt class="buy"  style="width: 40px;padding-left: 5px;">{:lang(\'BUY\')}' + (i + 1) + '</dt><dd class="buy"  style="width: 90px">' + parseFloat(buy_obj.price) + '</dd><dd class="buy"  style="width: 100px">' + parseFloat(buy_obj.nums) + '</dd><dd class="buy"  style="width: 120px;padding-left: 3px;">' + (buy_obj.price * buy_obj.nums).toFixed(6) + '</dd></dl>';
                    }
                }
                $("#buylist").html(list);
            }

            if(received_msg.sell){
                var list ='';
                received_msg.sell = getsort(received_msg.sell,'desc');
                if(trade_moshi == 1){
                    if(received_msg.sell.length <= 15){
                        received_msg.sell = received_msg.sell.reverse();
                        for(var i = received_msg.sell.length-1 ;i>=0;i--){
                            var sell_obj = received_msg.sell[i];
                            list += '<dl title="{:lang(\'BUY_AT_PRICE\')}" style="cursor: pointer;" onclick="autotrust(this,\'sell\',1)"><dt class="sell"  style="width: 40px;padding-left: 5px;">{:lang(\'SELL\')}' + (i + 1) + '</dt><dd class="sell"  style="width: 90px">' + parseFloat(sell_obj.price) + '</dd><dd class="sell"  style="width: 100px">' + parseFloat(sell_obj.nums) + '</dd><dd class="sell"  style="width: 120px;padding-left: 3px;">' + (sell_obj.price * sell_obj.nums).toFixed(6) + '</dd></dl>';
                        }
                    }else{
                        received_msg.sell = received_msg.sell.reverse();
                        for(var i = 14 ;i>=0;i--){
                            var sell_obj = received_msg.sell[i];
                            list += '<dl title="{:lang(\'BUY_AT_PRICE\')}" style="cursor: pointer;" onclick="autotrust(this,\'sell\',1)"><dt class="sell"  style="width: 40px;padding-left: 5px;">{:lang(\'SELL\')}' + (i+1) + '</dt><dd class="sell"  style="width: 90px">' + parseFloat(sell_obj.price) + '</dd><dd class="sell"  style="width: 100px">' + parseFloat(sell_obj.nums) + '</dd><dd class="sell"  style="width: 120px;padding-left: 3px;">' + (sell_obj.price * sell_obj.nums).toFixed(6) + '</dd></dl>';
                        }
                    }
                }else if(trade_moshi == 4){
                    for(var i = (received_msg.sell.length-1) ;i>=0;i--){
                        var sell_obj = received_msg.sell[i];
                        list += '<dl title="{:lang(\'BUY_AT_PRICE\')}" style="cursor: pointer;" onclick="autotrust(this,\'sell\',1)"><dt class="sell"  style="width: 40px;padding-left: 5px;">{:lang(\'SELL\')}' + (received_msg.sell.length-i) + '</dt><dd class="sell"  style="width: 90px">' + parseFloat(sell_obj.price) + '</dd><dd class="sell"  style="width: 100px">' + parseFloat(sell_obj.nums) + '</dd><dd class="sell"  style="width: 120px;padding-left: 3px;">' + (sell_obj.price * sell_obj.nums).toFixed(6) + '</dd></dl>';
                    }
                }

                $("#selllist").html(list);
            }
        }
    }

    function getTradelog() {
        $.getJSON("/Ajax/getTradelog?market=" + market + "&t=" + Math.random(), function (data) {
            if (data) {
                if (data['tradelog']) {
                    var list = '';
                    var type = '';
                    var typename = '';
                    for (var i in data['tradelog']) {
                        if (data['tradelog'][i]['type'] == 1) {
                            list += '<tr title="{:lang(\'SOLD_AT_PRICE\')}" onclick="autotrust(this,\'buy\',2)"><td class="buy"   width="180">' + data['tradelog'][i]['addtime'] + '</td><td class="buy"   width="80">{:lang(\'BUY\')}</td><td class="buy"   width="250">' + data['tradelog'][i]['price'] + '</td><td class="buy"  width="250">' + data['tradelog'][i]['num'] + '</td><td class="buy">' + data['tradelog'][i]['mum'] + '</td></tr>';
                        } else {
                            list += '<tr title="{:lang(\'BUY_AT_PRICE\')}" onclick="autotrust(this,\'sell\',2)"><td class="sell"   width="180">' + data['tradelog'][i]['addtime'] + '</td><td class="sell"   width="80">{:lang(\'SELL\')}</td><td class="sell"   width="250">' + data['tradelog'][i]['price'] + '</td><td class="sell"  width="250">' + data['tradelog'][i]['num'] + '</td><td class="sell">' + data['tradelog'][i]['mum'] + '</td></tr>';
                        }
                    }
                    $("#orderlist").html(list);
                }
            }
        });
        setTimeout('getTradelog()', 5000);
    }

    function getDepth() {
        if (trade_moshi != 2) {

            $.getJSON("/Ajax/getDepth?market=" + market + "&trade_moshi=" + trade_moshi + "&t=" + Math.random(), function (data) {
                if (data) {

                    if (data['depth']) {
                        var list = '';
                        var sellk = data['depth']['sell'].length;
                        if (data['depth']['sell']) {
                            for (i = 0; i < data['depth']['sell'].length; i++) {
                                list += '<dl title="{:lang(\'BUY_AT_PRICE\')}" style="cursor: pointer;" onclick="autotrust(this,\'sell\',1)"><dt class="sell"  style="width: 40px;padding-left: 5px;">{:lang(\'SELL\')}' + (sellk - i ) + '</dt><dd class="sell"  style="width: 90px">' + data['depth']['sell'][i][0] + '</dd><dd class="sell"  style="width: 100px">' + data['depth']['sell'][i][1] + '</dd><dd class="sell"  style="width: 120px;padding-left: 3px;">' + (data['depth']['sell'][i][0] * data['depth']['sell'][i][1]).toFixed(6) + '</dd></dl>';
                            }

                        }
                        $("#selllist").html(list);
                        list = '';
                        if (data['depth']['buy']) {
                            for (i = 0; i < data['depth']['buy'].length; i++) {
                                list += '<dl title="{:lang(\'SOLD_AT_PRICE\')}" style="cursor: pointer;" onclick="autotrust(this,\'buy\',1)"><dt class="buy"  style="width: 40px;padding-left: 5px;">{:lang(\'BUY\')}' + (i + 1) + '</dt><dd class="buy"  style="width: 90px">' + data['depth']['buy'][i][0] + '</dd><dd class="buy"  style="width: 100px">' + data['depth']['buy'][i][1] + '</dd><dd class="buy"  style="width: 120px;padding-left: 3px;">' + (data['depth']['buy'][i][0] * data['depth']['buy'][i][1]).toFixed(6) + '</dd></dl>';
                            }

                        }
                        $("#buylist").html(list);
                    }

                }
            });
            clearInterval(getDepth_tlme);

            var wait = second = 5;
            getDepth_tlme = setInterval(function () {
                wait--;
                if (wait < 0) {
                    clearInterval(getDepth_tlme);
                    getDepth();
                    wait = second;
                }
            }, 1000);
        }
    }

    function getEntrustAndUsercoin() {
        $.getJSON("/Ajax/getEntrustAndUsercoin?market=" + market + "&t=" + Math.random(), function (data) {
            if (data) {
                if (data['entrust']) {
                    $('#entrust_over').show();
                    var list = '';
                    var cont = data['entrust'].length;
                    for (i = 0; i < data['entrust'].length; i++) {
                        if (data['entrust'][i]['type'] == 1) {
                            list += '<tr title="{:lang(\'SOLD_AT_PRICE\')}" onclick="autotrust(this,\'buy\',2)"><td class="buy">' + data['entrust'][i]['addtime'] + '</td><td class="buy">{:lang(\'BUY\')}</td><td class="buy">' + data['entrust'][i]['price'] + '</td><td class="buy">' + data['entrust'][i]['num'] + '</td><td class="buy">' + data['entrust'][i]['deal'] + '</td><td class="buy">' + (data['entrust'][i]['price'] * data['entrust'][i]['num']).toFixed(8) + '</td><td><a style="color: #31A6DE;" class="cancelaa" id="' + data['entrust'][i]['id'] + '" onclick="cancelaa(\'' + data['entrust'][i]['id'] + '\')" href="javascript:void(0);">{:lang(\'RESCIND\')}</a></td></tr>';
                        } else {
                            list += '<tr title="{:lang(\'BUY_AT_PRICE\')}" onclick="autotrust(this,\'sell\',2)"><td class="sell">' + data['entrust'][i]['addtime'] + '</td><td class="sell">{:lang(\'SELL\')}</td><td class="sell">' + data['entrust'][i]['price'] + '</td><td class="sell">' + data['entrust'][i]['num'] + '</td><td class="sell">' + data['entrust'][i]['deal'] + '</td><td class="sell">' + (data['entrust'][i]['price'] * data['entrust'][i]['num']).toFixed(8) + '</td><td><a style="color: #31A6DE;" class="cancelaa" id="' + data['entrust'][i]['id'] + '" onclick="cancelaa(\'' + data['entrust'][i]['id'] + '\')" href="javascript:void(0);">{:lang(\'RESCIND\')}</a></td></tr>';
                        }
                    }
                    if (cont == 10) {
                        list += '<tr><td style="text_align:center;" colspan="7"><a href="/Finance/mywt" style="color: #2674FF;">{:lang(\'MORE_DELEGATION\')}</a>&nbsp;&nbsp;</td></tr>';
                    }
                    $('#entrustlist').html(list);
                } else {
                    $('#entrust_over').hide();
                }

                if (data['usercoin']) {
                    if (data['usercoin']['cny']) {
                        $("#my_rmb").html(data['usercoin']['cny']);
                    } else {
                        $("#my_rmb").html('0.00');
                    }

                    if (data['usercoin']['cnyd']) {
                        $("#my_rmbd").html(data['usercoin']['cnyd']);
                    } else {
                        $("#my_rmbd").html('0.00');
                    }

                    if (data['usercoin']['xnb']) {
                        $("#my_xnb").html(data['usercoin']['xnb']);
                    } else {
                        $("#my_xnb").html('0.00');
                    }

                    if (data['usercoin']['xnbd']) {
                        $("#my_xnbd").html(data['usercoin']['xnbd']);
                    } else {
                        $("#my_xnbd").html('0.00');
                    }
                }

            }
        });

        setTimeout('getEntrustAndUsercoin()', 5000);
    }

    $(function () {
        if ("WebSocket" in window && '{$Think.APP_SOCKET}' != 0){
            //window.ws = new WebSocket("wss://wss.btchkgj.com:2000/");
            (function wssocketreload(){
                window.ws = new WebSocket("wss://wss.btchkgj.com:2000/");
            })();
            window.ws.onopen = function(){
                var send_obj = {c:'TradeController',m:'both',u:'test',d:{market:market}};
                window.ws.send(get_encryption_param(send_obj));
            }
            window.ws.onmessage=function(env){
                var received_msg = JSON.parse(env.data);
                getTradelogSocket(received_msg.log);
                getDepthSocket(received_msg.market);
            }
            window.ws.onerror=function(){
                wssocketreload();
            }
            window.ws.onclose = function(){
            };
        } else {
            getTradelog();
            getDepth();
        }

        if (userid > 0) {
            getEntrustAndUsercoin();
        } else {
            $('#entrust_over').hide();
        }
    });


    function toNum(num, round) {
        return Math.abs(Math.round(num * Math.pow(10, round) - 1) / Math.pow(10, round));
    }


    // 自动填价格
    function autotrust(_this, type, cq) {

        if (type == 'sell') {
            $('#buy_price').val($(_this).children().eq(cq).html()).css({'font_size': '14px'});
            if ($("#my_rmb").html() > 0) {
                $("#buy_max").html(toNum(($("#my_rmb").html() / ($('#buy_price').val()+$('#buy_price').val()*0.002)), market_round_num));
            }
            if ($('#buy_num').val()) {
                $("#buy_mum").html(($('#buy_num').val() * $('#buy_price').val()).toFixed(8) * 1);
            }

        }
        if (type == 'buy') {
            $('#sell_price').val($(_this).children().eq(cq).html()).css({'fontSize': '14px'});
            if ($("#my_xnb").html() > 0) {
                $("#sell_max").html($("#my_xnb").html());
            }
            if ($('#sell_num').val()) {
                $("#sell_mum").html(($('#sell_num').val() * $('#sell_price').val()).toFixed(8) * 1);
            }
        }

    }


	function  setMaiChu(){
		$('#sell_price').val($.trim($('#sell_best_price').html().replace('￥', '')));
        var buyprice = parseFloat($('#buy_price').val());
        var buynum = parseFloat($('#buy_num').val());
        var sellprice = parseFloat($('#sell_price').val());
        var sellnum = parseFloat($('#sell_num').val());
        var buymum = buyprice * buynum;
        var sellmum = sellprice * sellnum;
        var myrmb = $("#my_rmb").html();
        var myxnb = $("#my_xnb").html();
        var buykenum = 0;
        var sellkenum = 0;
        if (myrmb > 0) {
            buykenum = myrmb / (buyprice + buyprice*0.002);
        }
        if (myxnb > 0) {
            sellkenum = myxnb;
        }
		
        if (buyprice != null && buyprice.toString().split(".") != null && buyprice.toString().split(".")[1] != null) {
            if (buyprice.toString().split('.')[1].length > market_round) {
                $('#buy_price').val(buyprice.toFixed(market_round));
            }
        }
        if (buynum != null && buynum.toString().split(".") != null && buynum.toString().split(".")[1] != null) {
            if (buynum.toString().split('.')[1].length > market_round_num) {
                $('#buy_num').val(toNum(buynum, market_round_num));
            }
        }
        if (sellprice != null && sellprice.toString().split(".") != null && sellprice.toString().split(".")[1] != null) {
            if (sellprice.toString().split('.')[1].length > market_round) {
                $('#sell_price').val(sellprice.toFixed(market_round));
            }
        }
        if (sellnum != null && sellnum.toString().split(".") != null && sellnum.toString().split(".")[1] != null) {
            if (sellnum.toString().split('.')[1].length > market_round_num) {
                $('#sell_num').val(toNum(sellnum, market_round_num));
            }
        }
        if (buymum != null && buymum > 0) {
            $('#buy_mum').html(buymum.toFixed(8) * 1);
        }
        if (sellmum != null && sellmum > 0) {
            $('#sell_mum').html(sellmum.toFixed(8) * 1);
        }
        if (buykenum != null && buykenum > 0 && buykenum != 'Infinity') {
            $('#buy_max').html(toNum(buykenum, market_round_num));
        }
        if (sellkenum != null && sellkenum > 0 && sellkenum != 'Infinity') {
            $('#sell_max').html(sellkenum);
        }
	
	}

	
	function setMaiRu(){
		$('#buy_price').val($.trim($('#buy_best_price').html().replace('￥', '')));
        var buyprice = parseFloat($('#buy_price').val());
        var buynum = parseFloat($('#buy_num').val());
        var sellprice = parseFloat($('#sell_price').val());
        var sellnum = parseFloat($('#sell_num').val());
        var buymum = buyprice * buynum;
        var sellmum = sellprice * sellnum;
        var myrmb = $("#my_rmb").html();
        var myxnb = $("#my_xnb").html();
        var buykenum = 0;
        var sellkenum = 0;
        if (myrmb > 0) {
            buykenum = myrmb / (buyprice + buyprice * 0.002);
        }
        if (myxnb > 0) {
            sellkenum = myxnb;
        }
		
        if (buyprice != null && buyprice.toString().split(".") != null && buyprice.toString().split(".")[1] != null) {
            if (buyprice.toString().split('.')[1].length > market_round) {
                $('#buy_price').val(buyprice.toFixed(market_round));
            }
        }
        if (buynum != null && buynum.toString().split(".") != null && buynum.toString().split(".")[1] != null) {
            if (buynum.toString().split('.')[1].length > market_round_num) {
                $('#buy_num').val(toNum(buynum, market_round_num));
            }
        }
        if (sellprice != null && sellprice.toString().split(".") != null && sellprice.toString().split(".")[1] != null) {
            if (sellprice.toString().split('.')[1].length > market_round) {
                $('#sell_price').val(sellprice.toFixed(market_round));
            }
        }
        if (sellnum != null && sellnum.toString().split(".") != null && sellnum.toString().split(".")[1] != null) {
            if (sellnum.toString().split('.')[1].length > market_round_num) {
                $('#sell_num').val(toNum(sellnum, market_round_num));
            }
        }
        if (buymum != null && buymum > 0) {
            $('#buy_mum').html(buymum.toFixed(8) * 1);
        }
        if (sellmum != null && sellmum > 0) {
            $('#sell_mum').html(sellmum.toFixed(8) * 1);
        }
        if (buykenum != null && buykenum > 0 && buykenum != 'Infinity') {
            $('#buy_max').html(toNum(buykenum, market_round_num));
        }
        if (sellkenum != null && sellkenum > 0 && sellkenum != 'Infinity') {
            $('#sell_max').html(sellkenum);
        }
	}
	
	
    $('#buy_price,#buy_num,#sell_price,#sell_num').css("ime-mode", "disabled").bind('keyup change', function () {
        var buyprice = parseFloat($('#buy_price').val());
        var buynum = parseFloat($('#buy_num').val());
        var sellprice = parseFloat($('#sell_price').val());
        var sellnum = parseFloat($('#sell_num').val());
        var buymum = buyprice * buynum;
        var sellmum = sellprice * sellnum;
        var myrmb = $("#my_rmb").html();
        var myxnb = $("#my_xnb").html();
        var buykenum = 0;
        var sellkenum = 0;
        if (myrmb > 0) {
            buykenum = myrmb / (buyprice + buyprice * 0.002);
        }
        if (myxnb > 0) {
            sellkenum = myxnb;
        }
		//alert("wobianliao");
		
        if (buyprice != null && buyprice.toString().split(".") != null && buyprice.toString().split(".")[1] != null) {
            if (buyprice.toString().split('.')[1].length > market_round) {
                $('#buy_price').val(buyprice.toFixed(market_round));
            }
        }
        if (buynum != null && buynum.toString().split(".") != null && buynum.toString().split(".")[1] != null) {
            if (buynum.toString().split('.')[1].length > market_round_num) {
                $('#buy_num').val(toNum(buynum, market_round_num));
            }
        }
        if (sellprice != null && sellprice.toString().split(".") != null && sellprice.toString().split(".")[1] != null) {
            if (sellprice.toString().split('.')[1].length > market_round) {
                $('#sell_price').val(sellprice.toFixed(market_round));
            }
        }
        if (sellnum != null && sellnum.toString().split(".") != null && sellnum.toString().split(".")[1] != null) {
            if (sellnum.toString().split('.')[1].length > market_round_num) {
                $('#sell_num').val(toNum(sellnum, market_round_num));
            }
        }
        if (buymum != null && buymum > 0) {
            $('#buy_mum').html(buymum.toFixed(8) * 1);
        }
        if (sellmum != null && sellmum > 0) {
            $('#sell_mum').html(sellmum.toFixed(8) * 1);
        }
        if (buykenum != null && buykenum > 0 && buykenum != 'Infinity') {
            $('#buy_max').html(toNum(buykenum, market_round_num));
        }
        if (sellkenum != null && sellkenum > 0 && sellkenum != 'Infinity') {
            $('#sell_max').html(sellkenum);
        }
    }).bind("paste", function () {
        //return false;
    }).bind("blur", function () {
        if (this.value.slice(-1) == ".") {
            this.value = this.value.slice(0, this.value.length - 1);
        }
    }).bind("keypress", function (e) {
        var code = (e.keyCode ? e.keyCode : e.which); //兼容火狐 IE
        if (this.value.indexOf(".") == -1) {
            return (code >= 48 && code <= 57) || (code == 46);
        } else {
            return code >= 48 && code <= 57
        }
    });


</script>


<script type="text/javascript" src="__PUBLIC__/home/js/jquery-ui.js"></script>
<script type="text/javascript">
    $(function () {
        slider();
    });
    // 买入/卖出 比例
    function slider() {
        var type = ['sell', 'buy'];
        for (var i in type) {
            $("#slider_" + type[i]).slider({
                value: 0, min: 0, max: 100, step: 10, range: "min", slide: function (a, t) {
                    var type = $(t.handle).attr('data_slide');
                    var e = parseFloat($("#" + type + '_max').text());
                    if (isNaN(e)) e = 0;
                    $("#" + type + ' .ui-slider-handle').addClass('ui-state-focus ui-state-active');
                    $("#" + type + "_num").val((e / 100 * t.value).toFixed(market_round_num));
                    $("#ratio_num_" + type).text(t.value + "%");
                    if ($('#' + type + '_price').val()) {
                        $("#" + type + "_mum").html(((e / 100 * t.value * $('#' + type + '_price').val())).toFixed(2) * 1);
                    }
                }
            })
        }
    }
</script>


<script>
    //菜单高亮
    $('#list-tab_index').addClass('on');
</script>
{include file="public:footer_1" /}